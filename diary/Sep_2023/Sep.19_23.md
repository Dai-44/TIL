## ログ
6:50  
- 昨日コミットし忘れて草生やせなかったのが悔しすぎるので、これからは朝イチでTIL書き始めたタイミングで一度コミット＆プッシュすることにする。これからヨガして皿洗いしたら中間試験始める。  

8:54  
- 卒業試験②の実装で詰まってる。他のユーザーのプロフィール閲覧はできるようになったが、自分のマイページの設定などを開こうとするとエラー起きる（他のユーザーのページでも同じこと起きる。）。「`Nil`クラスに`decorate`メソッドは定義されてない」と`_user.info.html.erb`で言われており、`decorate`メソッドのレシーバは`@user`なので、`@user`の定義がおかしそう。  

11:07  
- 上記の問題はとりあえず`@user`の定義を`my_page`全体で共有する（個々のコントローラではなくその上の階層で定義する）ことで、「`id`を指定せずにリクエストを送った場合」は全て`current_user`が`@user`に代入されるという画面遷移が実装できた（これで良いのかはわからないが、アプリ使用上の不都合などは差し当たってはなさそう）。  
- フォロー機能実装の記事を一通り確認したので、これから実装していく。スペックを確認する限りフォロー一覧、フォロワー一覧などは必須ではなさそうなので、とりあえず最低限の機能のみ取り組む。  

12:40  
- フォロー機能とフォローボタンの実装はできたが、フォロー状況に応じたボタンの出し分けがうまくいってない。`User`モデルに定義した`following?`メソッドを用いて条件分岐してボタンを出し分けようとしてるが、これが常に（フォローしてる相手に対しても）`false`になってるぽい。`following?`メソッド内の`include?`メソッドのレシーバを参考記事からやや変更して実装（フォロー一覧等の機能は不要と考えたため、フォローしているユーザーのレコードを`users`テーブルから取得する関連付けはしてなかった）していたため、それが関係してるのか？また、`include?`メソッドは配列に対するメソッドなので、引数をハッシュの形で渡すのもおかしい？そもそも今定義しているレシーバ（`followers`に`include?`メソッドは実行できる？）  
- 一回参考記事の言うとおりに実装してみる。  

13:35  
- 記事の言うとおり、`User`モデルでの関連付けに「フォローしているユーザーに関する`users`テーブルのレコード」を示す`following_users`を追記し、`following?`メソッド内の`include?`メソッドのレシーバを`following_users`に変更し、`views/mypage/shared/_follow_button`での`if`文の条件に渡す引数を`user.id`という特定の値から`user`というオブジェクトそのものに変更したら、うまくいった。  
-　原因を検討しロボらんてくんとも確認した。従来の`followers`関連付けはあくまで中間テーブルである`relationships`のレコードを取得していた（関連付けのメソッドは配列の形式で返るため、該当するレコードが複数の場合は個々のレコードを１要素とする配列が返る）。一方、追記した`following_users`関連付けでは、`followed`という関連名で`Relationship`モデルと紐づいている`users`テーブルのレコード群が返る。いずれにせよ１つのレコード情報が要素となる配列が返るため、`following?`メソッド内の`include?`メソッドでは、「レシーバとなる配列に、引数で渡されたオブジェクトが要素として含まれているか？」が判定され、含まれていれば`true`が返る。レシーバとなる配列にはレコード情報が要素として格納されているため、一致判定に用いる引数も同様にレコード情報とする必要がある。`following`メソッドの呼び出し元で明示する引数がそれにあたり、呼び出す場でUserオブジェクトが特定できるのであればそれを渡すことで`include?`メソッドを適切に実行できる。ただ、この時`include?`メソッドのレシーバが中間テーブル`relationships`のレコードを要素にもつ配列だった場合、呼び出し元で明示する引数も当該中間テーブルのレコードに該当するオブジェクトとする必要がある。呼び出し箇所は`view`ファイルであり、中間テーブルのレコードを頑張って指定して引数に渡すよりは、そのページで特定されているUserインスタンス（があれば。大概ある。）を引数に指定する方が圧倒的に楽。と言うわけで、記事の言うとおりに`users`テーブルのレコードを要素に持つ配列が返るような関連を新たに定義し、呼び出し元で`User`インスタンスを指定する対応を取ったことから、うまくいった。  




## ゆる学び
- `view`ファイルでパーシャルを`render`する際、`views`ディレクトリ配下のディレクトリを起点とするパスを明示しないと、パーシャルが見つからず`MissingTempleteError`が発生する。（呼び出し元とパーシャルのディレクトリが同じだったら省略できる、とかなかったっけ？）。   
